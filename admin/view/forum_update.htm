<?php include './view/header.inc.htm'; ?>

<div class="row">
	<div class="col-lg-10 col-lg-offset-1">
		<div class="card">
			<div class="card-block">
				<form action="<?php echo url("forum-update-$_fid");?>" method="post" id="form">
					<h4 class="card-title">版块编辑 - <?php echo $_forum['name'];?></h4>
					<div class="form-group row">
						<label class="col-sm-2 form-control-label">版块名称：</label>
						<div class="col-sm-10">
							<?php echo $input['name'];?>
						</div>
					</div>
					<div class="form-group row">
						<label class="col-sm-2 form-control-label">排序：</label>
						<div class="col-sm-3">
							<?php echo $input['rank'];?>
						</div>
					</div>
					<div class="form-group row">
						<label class="col-sm-2 form-control-label">版块介绍：</label>
						<div class="col-sm-10">
							<?php echo $input['brief'];?>
						</div>
					</div>
					<div class="form-group row">
						<label class="col-sm-2 form-control-label">版块公告：</label>
						<div class="col-sm-10">
							<?php echo $input['announcement'];?>
						</div>
					</div>
					<div class="form-group row">
						<label class="col-sm-2 form-control-label">版主：</label>
						<div class="col-sm-10">
							<?php echo $input['moduids'];?>
							<p class="small text-muted m-t-sm" id="modnames">最多允许10个，逗号隔开，如：123,456,789</p>
						</div>
					</div>
					<div class="form-group row">
						<label class="col-sm-2 form-control-label">用户权限：</label>
						<div class="col-sm-10">
							<p><label><?php echo $input['accesson'];?> 启用</label></p>
							<div class="table-responsive <?php echo $_forum['accesson'] ? '' : 'collapse';?>" id="accesslist_div">
								<table class="table" id="accesslist" style="min-width: 700px;">
									<thead>
										<tr align="center">
											<td width="80">全选</td>
											<td align="left">用户组</td>
											<td width="100">允许看帖</td>
											<td width="100">发主题</td>
											<td width="100">回贴</td>
											<td width="100">上传</td>
											<td width="100">下载</td>
										</tr>
									<thead>
									<tbody>
										<?php foreach ($accesslist as $access) { ?>
										<tr align="center">								
											<td><label class="c-input c-checkbox"><input type="checkbox" name="checkall" /><span class="c-indicator"></span></label></td>
											<td align="left"><?php echo $access['name']; ?></td>
											<td><label class="c-input c-checkbox"><input type="checkbox" name="allowread[<?php echo $access['gid']; ?>]" value="1"<?php echo ($access['allowread'] ? 'checked' : ''); ?> /><span class="c-indicator"></span></label></td>
											<td><label class="c-input c-checkbox"><input type="checkbox" name="allowthread[<?php echo $access['gid']; ?>]" value="1"<?php echo ($access['allowthread'] ? 'checked' : ''); ?> /><span class="c-indicator"></span></label></td>
											<td><label class="c-input c-checkbox"><input type="checkbox" name="allowpost[<?php echo $access['gid']; ?>]" value="1"<?php echo ($access['allowpost'] ? 'checked' : ''); ?> /><span class="c-indicator"></span></label></td>
											<td><label class="c-input c-checkbox"><input type="checkbox" name="allowattach[<?php echo $access['gid']; ?>]" value="1"<?php echo ($access['allowattach'] ? 'checked' : ''); ?> /><span class="c-indicator"></span></label></td>
											<td><label class="c-input c-checkbox"><input type="checkbox" name="allowdown[<?php echo $access['gid']; ?>]" value="1"<?php echo ($access['allowdown'] ? 'checked' : ''); ?> /><span class="c-indicator"></span></label></td>
										</tr>
										<?php } ?>
									</tbody>
								</table>
							
							</div>
						</div>
					</div>
					<div class="form-group row">
						<label class="col-sm-2 form-control-label"></label>
						<div class="col-sm-10">
							<button type="submit" class="btn btn-primary btn-block" id="submit" data-loading-text="<?php echo lang('submiting');?>..."><?php echo lang('confirm');?></button>
							<a role="button" class="btn btn-secondary btn-block m-t-1" href="javascript:history.back();"><?php echo lang('back');?></a>
						</div>
					</div>
				</form>
			</div>
		</div>
	</div>
</div>


<?php include './view/footer.inc.htm'; ?>

<script>

var jform = $("#form");
var jsubmit = $("#submit");
jform.on('submit', function(){
	var postdata = jform.serialize();
	jsubmit.button('loading');
	$.xpost(jform.attr('action'), postdata, function(code, message) {
		if(code == 0) {
			$.alert(message);
			jsubmit.text(message).delay(3000).button('reset');
			return;
		} else {
			$.alert(message);
			jsubmit.button('reset');
		}
	});
	return false;
});



var jaccesslist = $('#accesslist_div');

// toggle
jform.find('input[name="accesson"]').on('click', function() {
	//jaccesslist.collapse('toggle'); bootstrap toggler have bug
	jaccesslist.toggle('fast');
	return true;
});

// 全选
jaccesslist.find('tr').each(function(k, v) {
	var jtr = $(v);
	jtr.find('td').eq(0).find('input[type="checkbox"]').on('click', function() {
		jtr.find('input[type="checkbox"]').prop('checked', $(this).prop('checked'));
	});
});

// 版主姓名：
var jmoduids = jform.find('input[name="moduids"]');
var jmodnames = $('#modnames');
jmoduids.on('keyup blur', function(e) {
	if(e.type == 'keyup' && e.keyCode != 188) return;
	jmoduids.tooltip('dispose');
	$.xget(xn.url('admin/forum-getname-'+xn.urlencode(jmoduids.val())), function(code, message) {
		if(code > 0) {
			jmoduids.alert(message).focus();
		} else if(code ==0) {
			jmodnames.text(message);
		} else {
			$.alert(message);
		}
	});
});

$('#nav_pc li.forum').tab('show');
$('#nav_mobile li.forum').tab('show');

</script>