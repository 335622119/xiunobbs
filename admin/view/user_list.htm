<?php include './admin/view/header.inc.htm'; ?>

<div class="btn-group m-b-1" role="group">
	<?php echo bootstrap_tab_active($menu['user']['tab'], 'list');?>
</div>

<div class="row">
	<div class="col-md-4 m-b-sm">
		<select id="srchtype" value="<?php echo $srchtype; ?>" class="form-control">
			<option value="">搜索类型</option>
			<option value="uid">用户 ID：</option>
			<option value="username" selected>用户名：</option>
			<!--<option value="mobile" >手机号</option>-->
			<option value="email">Email：</option>
			<option value="gid">用户组：</option>
			<option value="create_ip">注册IP：</option>
		</select>
	</div>
	<div class="col-md-4 m-b-sm">
		<input type="text" id="keyword" placeholder="关键词" value="<?php echo $keyword; ?>"  class="form-control" />
	</div>
	<div class="col-md-4 m-b-sm">
		<button id="search" class="form-control btn btn-primary">搜索</button>
	</div>
</div>

<div class="row">
	<div class="col-lg-12">
		<div class="card">
			<div class="table-responsive">
				<table class="table" style="table-layout:fixed;">
					<thead>
						<tr>
							<th width="60" class="text-center">删除</th>
							<th width="50">ID：</th>
							<!--<th>手机号</th>-->
							<th width="150">Email</th>
							<th width="150">用户名</th>
							<th width="100">用户组</th>
							<th width="100">创建日期</th>
							<th width="100">注册IP</th>
							<th width="60">操作</th>
						</tr>
					</thead>
					<tbody>
				<?php foreach($userlist as &$_user){ ?>
					<tr uid="<?php echo $_user['uid']; ?>">
						<td class="text-center"><input type="checkbox" name="delete" /></td>
						<td><?php echo $_user['uid']; ?></td>
						<!--<td><?php echo $_user['mobile']; ?></td>-->
						<td><?php echo $_user['email']; ?></td>
						<td><?php echo $_user['username']; ?></td>
						<td><?php echo $_user['group']['name']; ?></td>
						<td><?php echo $_user['create_date_fmt']; ?></td>
						<td><?php echo $_user['create_ip_fmt']; ?></td>
						<td><a href="admin/user-update-<?php echo $_user['uid']; ?>.htm">编辑</a></td>
					</tr>
				<?php } ?>
					</tbody>
				</table>
			</div>
		</div>
		<div class="page"><a>总共: <?php echo $n; ?></a><?php echo $pagehtml; ?></div>
	</div>
</div>

<?php include './admin/view/footer.inc.htm'; ?>

<script>
	var jbody = $("#userbody");
	var jcreate = $('#create');
 	var jconfirm = $("#confirm");
	var jsearch = $("#search");
	var jsrchtype = $("#srchtype");
	var jkeyword = $('#keyword');
	var juserlist = $('#userlist');

	jsrchtype.val(jsrchtype.attr('value'));

	jcreate.on('click', function(event) {
		window.location = 'admin/user-create.htm';
	});

	jsearch.on('click', function(){
		var srchtype = jsrchtype.val();
		srchtype = srchtype ? srchtype : 'uid';
		var keyword = $("#keyword").val();
		var url = 'admin/user-list-'+srchtype+'-'+urlencode(keyword)+'-1.htm';
		window.location = url;
	});
	jkeyword.on('keydown', function(e) {
		if(e.keyCode == 13) jsearch.trigger('click');
	});

	// 删除选中的用户
	jconfirm.on('click', function(){
		var jchecked = juserlist.find('input[name="delete"]').filter(function(){ return this.checked; });
		if(jchecked.length < 1) return alert("请勾选您要删除的用户");
		if(!window.confirm("确定删除用户？")) return false;
		jchecked.each(function() {
			jtr = $(this).parents('tr');
			var uid = jtr.attr('uid');
			if(uid == 1) return alert('不允许删除管理员用户!');
			$.xpost('admin/user-delete.htm', {uid:uid}, function(code, message) {
				if(code == 0) {
					jtr.remove();
				} else {
					jtr.addClass('error').popover(message);
				}
			});
		});
	});
</script>