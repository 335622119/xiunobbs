<?php include _include(ADMIN_PATH.'view/htm/header.inc.htm');?>

<!--{hook admin_forum_list_start.htm}-->

<script type="text/x-template" id="tpl_forum">
<ul>
	<li v-for="(cate,index) in catelist" :fid="cate.fid">
		<comp-forum :forum="cate" level="1" :is_last="index === catelist.length - 1"></comp-forum>
		<table>
			<tr>
				<td>{{ forum.fid }}</td>
				<td><a href="javascript:void(0);" @click="new_forum(forum.fup)" v-if="is_last">[+]</a><input type="text" :value="forum.name" /></td>
				<td><img :src="'../'+forum.icon_url" width="32" /></td>
				<td><input type="file" multiple="multiple" accept=".jpg,.jpeg,.png,.gif,.bmp" class="form-control" :name="'icon['+forum.fid+']'" value="" :data-assoc="'img_'+forum.fid" placeholder="<?php echo lang('forum_icon');?>" /></td>
				<td>
					<a href="javascript:void(0);" @click="new_sub(forum)" v-if="level != 3">[+]</a>
					<a href="javascript:void(0);" @click="delete_forum(forum)">[-]</a>
				</td>
			</tr>
		</table>

	</li>
</ul>
</script>

<div id="forumlist">
	<form @submit.prevent="onsubmit">
		
		<p>
			<button>保存</button>
		</p>
		</template>
	</form>
</div>


<!--{hook admin_forum_list_end.htm}-->

<?php include _include(ADMIN_PATH.'view/htm/footer.inc.htm');?>

<script src="../view/js/vue.js"></script>
<script>
var forumobj = forumlist;
var forumlist = Object.values(forumlist);
var maxfid = <?php echo forum_maxid();?>;
Vue.component('comp-forum', {
	props: ['forum', 'level', 'is_last'],
	template: '#tpl_forum',
	methods: {
		// 同级增加
	  	new_forum: function(forum) {
	  		var arr = {fid: ++maxfid, fup: forum.fup, name: "新版块"};
	  		forumlist.push(arr);
	  	}, 
	  	new_sub: function(forum) {
	  		var arr = {fid: ++maxfid, fup: forum.fid, name: "新版块"};
	  		forumlist.push(arr);
	  	},
	  	delete_forum: function(forum) {
	  		//forumlist.
	  	}
  	}
});

var app = new Vue({
	el: '#forumlist',
	data: {
		catelist: forumlist,
		fid: 0,
	},
	computed:{
		forumlist: function() {
			return this.find_sub_list(this.fid);
		},
		sublist: function() {
			return this.find_sub_list(this.fid);
		},
		cate: function() {
			return forumobj[this.fid];
		},
		forum: function() {
			return forumobj[this.fid];
		},
		sub: function() {
			return forumobj[this.fid];
		}
	},
	methods: {
		onsubmit: function() {
			// ajax post 提交
			//console.log(forumlist);
			//alert(123);
		},
		// 查找儿子
		find_sub_list: function(fid) {
			var sublist = [];
			for(var k in forumlist) {
				if(forumlist[k]['fup'] == fid) {
					sublist.push(forumlist[k]);
				}
			}
			return sublist;
		}
	}
 /* watch: {
  	message: function(newmessage) {
  		if(newmessage == 'a') alert('a');
  	}
  },*/
  /*methods: {
  	reverseMessage: function() {
  		this.message = this.message.split('').reverse().join('');
  	}
  },*/
 /* computed: {
  	classObject: function() {
  		return {
  			active: this.isActive
  		}
  	}
  }*/
});


 </script>

<!--{hook admin_forum_list_js.htm}-->