<?php include "./view/htm/header.inc.htm"; ?>

<div class="row">
	<div class="col-lg-10 col-lg-offset-1">
		<div class="card">
			<div class="card-block">
				<h4 class="card-title"><?php echo lang('post_update');?></h4>
				<form action="<?php echo url("post-update-$pid");?>" method="post" id="form">
					<input type="hidden" name="doctype" value="<?php echo $post['doctype'];?>" />
					<?php if($isfirst) { ?>
					<fieldset class="form-group">
						<input type="text" class="form-control" placeholder="<?php echo lang('subject');?>" name="subject" value="<?php echo $thread['subject'];?>" id="subject">
					</fieldset>
					<?php } ?>
					<fieldset class="form-group">
						<textarea class="form-control" placeholder="<?php echo lang('message');?>" name="message" id="message" style="height: 300px;"><?php echo $post['message'];?></textarea>
					</fieldset>
					<?php if($isfirst) { ?>
					<fieldset class="form-group">
						<select class="c-select" name="fid">
							<?php foreach ($forumlist_show as $forum) { ?>
							<option value="<?php echo $forum['fid']; ?>"><?php echo $forum['name']; ?></option>
							<?php } ?>
						</select>
					</fieldset>
					<?php } ?>
					<button type="submit" class="btn btn-primary" id="submit" data-loading-text="<?php echo lang('submiting');?>..."> <?php echo lang('post_update');?> </button>
				</form>
			</div>
		</div>
	</div>
</div>

<?php include "./view/htm/footer.inc.htm"; ?>

<script>
var tid = <?php echo $tid;?>;
var jform = $('#form');
var jsubmit = $('#submit');
jform.on('submit', function() {
	var postdata = jform.serialize();
	jsubmit.button('loading');
	$.xpost(jform.attr('action'), postdata, function(code, message) {
		if(code == 0) {
			$.alert(message);
			jsubmit.button(message).delay(3000).location(xn.url('thread-'+tid));
		} else if(code < 0) {
			alert(message);
			jsubmit.button('reset');
		} else {
			jform.find('[name="'+code+'"]').alert(message).focus();
			jsubmit.button('reset');
		}
	});
	return false;
});

// checked
jform.find('[name="fid"]').checked(<?php echo $fid;?>);

$('#nav_pc li[fid="<?php echo $fid;?>"]').tab('show');
$('#nav_mobile li[fid="<?php echo $fid;?>"]').tab('show');

</script>



<!--- 百度编辑器 -->

 <!-- 加载编辑器的容器 -->

 

<link href="plugin/xn_umeditor/themes/default/css/umeditor.min.css" type="text/css" rel="stylesheet">

<style>

/*设置按扭样式*/
.edui-icon-test{
	background-position: -380px 0;
}
#file1 {
	width: 20px;
	height: 20px;
	background: transparent;
	opacity: 0;
	position: absolute;
	left: 0;
	top: 0;
}
</style>

<script type="text/javascript" src="plugin/xn_umeditor/umeditor.config.js"></script>

<script type="text/javascript" src="plugin/xn_umeditor/umeditor.js"></script>
<script type="text/javascript" src="plugin/xn_umeditor/lang/zh-cn/zh-cn.js"></script>
<script type="text/javascript">
/**
 * 段落样式
 * @function
 * @name UM.execCommand
 * @param   {String}   cmdName     paragraph插入段落执行命令
 * @param   {String}   style               标签值为：'p', 'h1', 'h2', 'h3', 'h4', 'h5', 'h6'
 * @param   {String}   attrs               标签的属性
 * @author zhanyi
 */
/*
UM.plugins['paragraph'] = function() {
    var me = this;
    me.setOpt('paragraph',{'p':'', 'h1':'', 'h2':'', 'h3':'', 'h4':'', 'h5':'', 'h6':''});
	alert('abc');
	var jimage = $('<input type="file" style="width: 100px; height: 40px;">').insertAfter('div.edui-icon-image');

    me.commands['paragraph'] = {
        execCommand : function( cmdName, style ) {
       		alert(cmdName);
            return this.document.execCommand('formatBlock',false,'<' + style + '>');
        },
        queryCommandValue : function() {
            try{
                var  val = this.document.queryCommandValue('formatBlock')
            }catch(e){
            }
            return val ;
        }
    };
};


*/

window.UMEDITOR_CONFIG.toolbar = [
    // 加入一个 test
    'test | bold italic underline ',
    '| fullscreen'
];

// 先执行
UM.plugins['test'] = function() {
};

// 后执行
UM.registerUI( 'test', function( name ){
    var me = this;
    var $btn = $.eduibutton({
        icon: name,
        title: 'xiuno image',
        html: '<input type="file" value="" id="file1" />', 
        click: function(e) {
        	console.log(e);
        }
    });
    
    $btn.find('input[type="file"]').on('change', function(e) {
    	me.execCommand('inserthtml', e.target.value);
    });
    
    me.addListener('selectionchange', function () {
        var state = this.queryCommandState(name);
              $btn.edui().disabled(state == -1).active(state == 1);
    });
    return $btn;
    
});

var serverPath = '/server/umeditor/';

var um = UM.getEditor('message', {
    imageUrl:serverPath + "imageUp.php",
    imagePath:serverPath,
    lang:/^zh/.test(navigator.language || navigator.browserLanguage || navigator.userLanguage) ? 'zh-cn' : 'en',
    langPath:UMEDITOR_CONFIG.UMEDITOR_HOME_URL + "lang/",
    focus: true
});

um.ready(function() {
	//$('<input type="file">').appendTo(um.);
});
console.log(um);




</script>

