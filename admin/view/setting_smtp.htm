<?php include './admin/view/header.inc.htm'; ?>

<div class="row m-t-1">
	<div class="col-lg-10 col-lg-offset-1">
		<div class="btn-group m-b-1" role="group" aria-label="Basic example">
			<a role="button" class="btn btn btn-secondary" href="admin/<?php echo url('setting-base');?>">基本设置</a>
			<a role="button" class="btn btn btn-secondary active" href="admin/<?php echo url('setting-smtp');?>">SMTP 设置</a>
		</div>
		<div class="card">
			<div class="card-block">
				<form action="admin/<?php echo url('setting-base');?>" method="post" id="form">
					<h4 class="card-title">设置</h4>
					<div class="form-group row">
						<label class="col-sm-3 form-control-label">开启注册邮箱验证：</label>
						<div class="col-sm-9">
							<?php echo $input_user_create_email_on;?>
						</div>
					</div>
					<div class="form-group row">
						<label class="col-sm-3 form-control-label">开启找回密码：</label>
						<div class="col-sm-9">
							<?php echo $input_user_find_pw_on;?>
						</div>
					</div>
					<h4 class="card-title">SMTP 列表</h4>
					<div class="table-responsive smtplist">
						<table width="100%" class="table">
							<thead>
								<!--
								<tr align="center">
									<th width="200">邮箱</th>
									<th width="200">主机</th>
									<th width="100">端口</th>
									<th width="150">账号</th>
									<th width="150">密码</th>
									<th align="80">删除</th>
								</tr>
								-->
								<tr align="center">
									<th>邮箱</th>
									<th>主机</th>
									<th>端口</th>
									<th>账号</th>
									<th>密码</th>
									<th class="text-center">删除</th>
								</tr>
							<thead>
							<tbody>
								<?php foreach($smtplist as $smtpid=>$smtp) { ?>
								<tr align="center" smtpid="<?php echo $smtpid; ?>">
									<td><input type="text" class="form-control" name="email[<?php echo $smtpid;?>]" value="<?php echo $smtp['email']; ?>" style="width: 180px;" placeholder="Email" /></td>
									<td><input type="text" class="form-control" name="host[<?php echo $smtpid;?>]" value="<?php echo $smtp['host']; ?>" style="width: 180px;" placeholder="主机" /></td>
									<td><input type="text" class="form-control" name="port[<?php echo $smtpid;?>]" value="<?php echo $smtp['port']; ?>" style="width: 60px;" placeholder="端口"/></td>
									<td><input type="text" class="form-control" name="user[<?php echo $smtpid;?>]" value="<?php echo $smtp['user']; ?>" style="width: 100px;" placeholder="用户名"  /></td>
									<td><input type="text" class="form-control" name="pass[<?php echo $smtpid;?>]" value="<?php echo $smtp['pass']; ?>" style="width: 100px;" placeholder="密码"  /></td>
									<td><a class="btn smtp_delete" role="btn">删除</a></td>
								</tr>
								<?php } ?>
							</tbody>
						</table>
					</div>
					<p><a role="button" class="btn smtp_add">[+]增加一行</a></p>
					<p class="text-center">
						<button type="submit" class="btn btn-primary" id="submit" data-loading-text="<?php echo lang('submiting');?>..." style="width: 10rem;"><?php echo lang('confirm');?></button>
					</p>
				</form>
			</div>
		</div>
	</div>
</div>

<?php include './admin/view/footer.inc.htm'; ?>

<script>

var jform = $("#form");
var jsubmit = $("#submit");
jform.on('submit', function(){
	var postdata = jform.serialize();
	jsubmit.button('loading');
	$.xpost(jform.attr('action'), postdata, function(code, message) {
		if(code == 0) {
			jsubmit.text(message);
			setTimeout(function(){ jsubmit.button('reset'); }, 1000);
			return;
		} else {
			alert(message);
			jsubmit.button('reset');
		}
	});
	return false;
});

// 处理删除
var jsmtplist = $('.smtplist');
var jdelete = $('a.smtp_delete');
jsmtplist.on('click', 'a.smtp_delete', function() {
	var jthis = $(this);
	var jtr = jthis.parents('tr');
	var smtpid = jtr.attr('smtpid');
	jtr.remove();
	return false;
});

var jadd = $('a.smtp_add');
jadd.on('click', function() {
	
	var jclone = jsmtplist.find('tr').last().clone();
	jclone.insertAfter(jsmtplist.find('tr').last());
	return false;
});
</script>